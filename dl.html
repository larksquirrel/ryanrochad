<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Ryan Rochad</title>
<style type="text/css">
  、
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f4f4f4;
}
.container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  min-height: 100vh;
  padding: 0 50px;
}
.left-section {
  background-color: white;
  padding: 30px;
  border-radius: 5px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
  width: 400px;
}
.logo img {
  width: 150px;
}
.tabs {
  display: flex;
  list-style-type: none;
  margin: 20px 0;
  padding: 0;
}
.tabs li {
  padding: 10px 20px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
}
.tabs li.active {
  border-bottom: 2px solid #6c5ce7;
  color: #6c5ce7;
}
form input {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 3px;
  box-sizing: border-box;
}
form button {
  width: 100%;
  padding: 10px;
  background-color: #6c5ce7;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}
.forgot-password {
  text-align: center;
  margin-top: 10px;
  color: #6c5ce7;
  cursor: pointer;
}
.or {
  text-align: center;
  margin: 10px 0;
}
.social-login a {
  margin: 0 5px;
}
.right-section {
  flex: 1;
  text-align: center;
}
.right-section img {
  max-width: 100%;
  height: auto;
}
#signup-form {
  display: none;
}
/* 忘记密码模态窗口样式 */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}
.modal-content {
  background-color: white;
  margin: 15% auto;
  padding: 20px;
  border-radius: 5px;
  width: 400px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.close:hover {
  color: black;
}
.modal-title {
  margin-top: 0;
  margin-bottom: 20px;
  color: #6c5ce7;
}
.modal-message {
  margin-top: 15px;
  padding: 10px;
  border-radius: 3px;
  display: none;
}
.success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}
.error {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}
</style>
</head>

<body>
<div class="container">
  <div class="left-section">
    <div class="logo">
      <img src="images/37eef08795715baa9746a6829c38d89.png" width="20" height="120" alt=""/>
    </div>
    <ul class="tabs">
      <li class="active" id="login-tab">LOGIN</li>
      <li id="signup-tab">SIGN UP</li>
    </ul>

    <!-- 登录表单 -->
    <form id="login-form">
      <input type="email" id="login-email" placeholder="Email">
      <input type="password" id="login-password" placeholder="Password">
      <button type="button" id="login-button">LOGIN</button>

      <!-- 找回密码按钮 -->
      <p class="forgot-password" id="forgot-password-link" style="cursor:pointer;">
        Forgot Password?
      </p>

      <p class="or">or</p>
      <div class="social-login">
        <p align="center">
          <a href="https://weixin.qq.com/">WeChat Login</a>
          <a href="https://im.qq.com/index/">QQ Login</a>
        </p>
      </div>
    </form>

    <!-- 注册表单 -->
    <form id="signup-form" style="display:none;">
      <input type="text" id="username" placeholder="Username" required>
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <input type="password" id="confirm-password" placeholder="Confirm Password" required>
      <button type="button" id="signup-button">SIGN UP</button>
    </form>
  </div>

  <div class="right-section">
    <img src="images/cc54910e440a2e5c3bc6fcc9b17674a.jpg" width="900" height="700" alt=""/>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const { createClient } = supabase;
const client = createClient(
  'https://nixlipqiyezzfvwqtdzj.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5peGxpcHFpeWV6emZ2d3F0ZHpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMTIxODEsImV4cCI6MjA3NzU4ODE4MX0.rZvDmHfMkF5gZM2VWSQuS35LfWL2naJqScVY1Z8g0B4'
);

// 处理认证回调（Magic Link）
async function handleAuthCallback() {
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    const accessToken = hashParams.get('access_token');
    const refreshToken = hashParams.get('refresh_token');
    const type = hashParams.get('type');

    if (accessToken && type === 'magiclink') {
        const { data, error } = await client.auth.setSession({
            access_token: accessToken,
            refresh_token: refreshToken
        });

        if (!error) window.location.href = 'ziliao.html';
    }
}

document.addEventListener('DOMContentLoaded', function() {
  handleAuthCallback();

  const loginTab = document.getElementById('login-tab');
  const signupTab = document.getElementById('signup-tab');
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const loginButton = document.getElementById('login-button');
  const signupButton = document.getElementById('signup-button');
  const forgotPasswordLink = document.getElementById('forgot-password-link');

  /* 切换 tab */
  loginTab.addEventListener('click', function() {
    loginTab.classList.add('active');
    signupTab.classList.remove('active');
    loginForm.style.display = 'block';
    signupForm.style.display = 'none';
  });

  signupTab.addEventListener('click', function() {
    signupTab.classList.add('active');
    loginTab.classList.remove('active');
    signupForm.style.display = 'block';
    loginForm.style.display = 'none';
  });

  /* 注册功能 */
  signupButton.addEventListener('click', async function() {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    if (password !== confirmPassword) {
      alert('Passwords do not match');
      return;
    }

    const { error } = await client.auth.signUp({
      email,
      password,
      options: {
        data: { username },
        emailRedirectTo: 'http://www.ryanrochad.com/'
      }
    });

    if (error) alert(error.message);
    else alert("Registration successful! Please check your email.");
  });

  /* 登录功能 */
  loginButton.addEventListener('click', async function() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;

    const { error } = await client.auth.signInWithPassword({ email, password });

    if (error) alert('Login failed: ' + error.message);
    else window.location.href = 'ziliao.html';
  });

  /* 找回密码功能（全新） */
  forgotPasswordLink.addEventListener('click', async function() {
    const email = prompt("请输入你注册时的邮箱 / Please enter your registered email:");
    if (!email) return;

    const { error } = await client.auth.resetPasswordForEmail(email, {
      redirectTo: "https://www.ryanrochad.com/reset-password.html"
    });

    if (error) alert("发送失败：" + error.message);
    else alert("重置密码邮件已发送，请检查你的邮箱！");
  });
});
</script>
</body>


</html>